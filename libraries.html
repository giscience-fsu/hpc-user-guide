<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Libraries and Environment Modules | HPC User Guide</title>
<meta name="author" content="Patrick Schratz, Jannes Muenchow">
<meta name="generator" content="bookdown 0.22.17 with bs4_book()">
<meta property="og:title" content="Chapter 5 Libraries and Environment Modules | HPC User Guide">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Libraries and Environment Modules | HPC User Guide">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><meta name="description" content="5.1 Introduction Environment modules are needed to make certain libraries (e.g. R) available across all nodes in the cluster. Environment variables are installed and maintained via Spack.  Please...">
<meta property="og:description" content="5.1 Introduction Environment modules are needed to make certain libraries (e.g. R) available across all nodes in the cluster. Environment variables are installed and maintained via Spack.  Please...">
<meta name="twitter:description" content="5.1 Introduction Environment modules are needed to make certain libraries (e.g. R) available across all nodes in the cluster. Environment variables are installed and maintained via Spack.  Please...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HPC User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="rstudio-workbench.html"><span class="header-section-number">2</span> RStudio Workbench</a></li>
<li><a class="" href="shiny-server.html"><span class="header-section-number">3</span> Shiny Server</a></li>
<li><a class="" href="slurm-hpc-scheduler.html"><span class="header-section-number">4</span> SLURM: HPC scheduler</a></li>
<li><a class="active" href="libraries.html"><span class="header-section-number">5</span> Libraries and Environment Modules</a></li>
<li><a class="" href="miscellaneous-helpers.html"><span class="header-section-number">6</span> Miscellaneous Helpers</a></li>
<li><a class="" href="troubleshooting-and-cautionary-notes.html"><span class="header-section-number">7</span> Troubleshooting and Cautionary Notes</a></li>
<li><a class="" href="admin-tasks.html"><span class="header-section-number">8</span> Admin Tasks</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="libraries" class="section level1">
<h1>
<span class="header-section-number">5</span> Libraries and Environment Modules<a class="anchor" aria-label="anchor" href="#libraries"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2">
<h2>
<span class="header-section-number">5.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>Environment modules are needed to make certain libraries (e.g. R) available across all nodes in the cluster.</p>
<p>Environment variables are installed and maintained via <a href="spack.io">Spack</a>.</p>
<div class="rmdcaution">
<p>
Please note that RStudio Workbench is decoupled from Slurm. Everything which should be run on the nodes via Slurm requires to have the respective environment modules loaded in the Slurm template file whereas if you run something in RStudio Workbench, the libraries installed in the underlying Ubuntu 20.04 container will be used.
</p>
</div>
<p>The following part only deals with the Spack configuration side as everything in the container should just work (with respect to R).</p>
<p>Available env modules can be queried in the terminal via <code>modules avail</code>.</p>
<p>To be able to load modules, put the following at the top of your <code>~/.bashrc</code> file:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="libraries.html#cb12-1"></a><span class="bu">export</span> <span class="va">SPACK_ROOT=</span>/opt/spack</span>
<span id="cb12-2"><a href="libraries.html#cb12-2"></a><span class="bu">.</span> <span class="va">$SPACK_ROOT</span><span class="ex">/share/spack/setup-env.sh</span></span>
<span id="cb12-3"><a href="libraries.html#cb12-3"></a></span>
<span id="cb12-4"><a href="libraries.html#cb12-4"></a><span class="bu">export</span> <span class="va">MODULEPATH=</span>/opt/spack/share/spack/modules/linux-centos7-x86_64</span></code></pre></div>
<p>(The export of the <code>MODULEPATH</code> env var should actually be done by the spack setup script but failed in the past for some users. Adding it manually should do no harm.)</p>
<p>Here is a sample output of <code>module avail</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="libraries.html#cb13-1"></a><span class="ex">-------------------------</span> /opt/spack/share/spack/modules/linux-centos7-x86_64 --------------------------</span>
<span id="cb13-2"><a href="libraries.html#cb13-2"></a>   <span class="ex">byobu-5.127-gcc-9.2.0-by2qc2g</span>          (L)    <span class="ex">python-3.7.4-gcc-9.2.0-nbjbfzi</span>     (L)</span>
<span id="cb13-3"><a href="libraries.html#cb13-3"></a>   <span class="ex">ccache-3.3.4-gcc-9.2.0-v3xzqqh</span>         (L)    <span class="ex">r-3.5.2-gcc-9.2.0-oxo76vo</span></span>
<span id="cb13-4"><a href="libraries.html#cb13-4"></a>   <span class="ex">curl-7.63.0-gcc-9.2.0-cq4w37y</span>          (L)    <span class="ex">r-3.6.1-gcc-9.2.0-j25wr6z</span></span>
<span id="cb13-5"><a href="libraries.html#cb13-5"></a>   <span class="ex">fish-3.0.0-gcc-9.2.0-gdyab6r</span>      </span></code></pre></div>
</div>
<div id="loading-modules" class="section level2">
<h2>
<span class="header-section-number">5.2</span> Loading modules<a class="anchor" aria-label="anchor" href="#loading-modules"><i class="fas fa-link"></i></a>
</h2>
<p>Modules can be loaded via <code>module load &lt;module&gt;</code>.</p>
<p>First, a C compiler need to be loaded as most other libraries depend on it.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="libraries.html#cb14-1"></a><span class="ex">module</span> load gcc-9.2.0-gcc-4.8.5-wqdecm4</span></code></pre></div>
<p>Next, load all libraries your analysis/R packages need, for example GDAL, PROJ, etc.</p>
<div class="rmdcaution">
<p>
You should load the modules both within <code>~/.bashrc</code> and within your SLURM template.
</p>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="slurm-hpc-scheduler.html"><span class="header-section-number">4</span> SLURM: HPC scheduler</a></div>
<div class="next"><a href="miscellaneous-helpers.html"><span class="header-section-number">6</span> Miscellaneous Helpers</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#libraries"><span class="header-section-number">5</span> Libraries and Environment Modules</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">5.1</span> Introduction</a></li>
<li><a class="nav-link" href="#loading-modules"><span class="header-section-number">5.2</span> Loading modules</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HPC User Guide</strong>" was written by Patrick Schratz, Jannes Muenchow. It was last built on 2021-08-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
